<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Flash Fiber FTTH | Visor GIS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ICONOS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <!-- MAPBOX -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet" />

  <!-- CSS -->
  <link rel="stylesheet" href="../assets/css/theme.css">
  <link rel="stylesheet" href="../assets/css/mobile.css">
  <link rel="stylesheet" href="../assets/css/layout.css">
  <link rel="stylesheet" href="../assets/css/map.css">
  <link rel="stylesheet" href="../assets/css/panels.css">
</head>

<body class="app-map">


  <header class="header">
    <div class="logo">
      <i class="fas fa-satellite-dish"></i>
      <span>Flash Fiber FTTH</span>
    </div>
  </header>

  <!-- ğŸ”˜ BOTÃ“N FLOTANTE SIDEBAR -->
  <div id="btnSidebar">
    <i class="fas fa-bars"></i>
  </div>

  <!-- ğŸ“‚ SIDEBAR OVERLAY -->
  <div class="sidebar-overlay"></div>
  <aside id="sidebar" class="sidebar hidden">

    <div class="sidebar-header">
      <h2>FLASH FIBER</h2>
      <span>FTTH Platform</span>
    </div>

    <nav class="sidebar-menu">

      <section class="menu-section">
        <div class="menu-title">ğŸ“ OperaciÃ³n</div>
        <button class="menu-item" data-action="gps">ğŸ“ GPS</button>
        <button class="menu-item" data-action="medir">ğŸ“ Medir</button>
        <button class="menu-item" data-action="navegar">ğŸš— Navegar</button>
      </section>

      <section class="menu-section">
        <div class="menu-title">ğŸ—ºï¸ Red FTTH</div>
        <button class="menu-item" id="btnOpenLayers">ğŸ§± Capas</button>
        <button class="menu-item">ğŸ¢ Centrales</button>
        <button class="menu-item">ğŸ§µ MolÃ©culas</button>
        <button class="menu-item">ğŸ”’ Cierres</button>
        <button class="menu-item">ğŸ“¦ NAP</button>
      </section>

      <section class="menu-section">
        <div class="menu-title">ğŸ› ï¸ Herramientas</div>
        <button class="menu-item" data-action="ruta">ğŸ›£ï¸ Montar Ruta</button>
        <button class="menu-item" data-action="cierres">ğŸ§± Montar Cierre</button>
        <button class="menu-item" data-action="eventos">ğŸ“ Evento</button> <!-- âœ… -->
        <button class="menu-item">ğŸ“· Fotos</button>
      </section>

    </nav>
  </aside>

  <!-- ğŸ—ºï¸ MAPA -->
<main class="map-wrapper">
  <div id="map"></div>

  <div class="map-controls" style="display: flex !important; visibility: visible !important; opacity: 1 !important; z-index: 99999 !important; position: fixed !important;">
    <button id="btnGPS" style="display: flex !important; visibility: visible !important; opacity: 1 !important;"><i class="fas fa-location-crosshairs"></i></button>
    <button id="btnMedir" style="display: flex !important; visibility: visible !important; opacity: 1 !important;"><i class="fas fa-ruler"></i></button>
    <button id="btnCapas" style="display: flex !important; visibility: visible !important; opacity: 1 !important;"><i class="fas fa-layer-group"></i></button>

    <!-- âŒ Si ya no usas cambio de base, puedes eliminar btnBaseMap -->
    <!-- <button id="btnBaseMap"><i class="fas fa-globe"></i></button> -->

    <!-- ğŸ§­ ROTACIÃ“N ON / OFF -->
    <button id="btnRotate" title="Rotar mapa" style="display: flex !important; visibility: visible !important; opacity: 1 !important;">
      <i class="fas fa-sync-alt"></i>
    </button>

    <!-- âœ… Finalizar ruta -->
    <button id="btnFinishRuta" title="Finalizar Ruta" style="display: flex !important; visibility: visible !important; opacity: 1 !important;">
      <i class="fas fa-check"></i>
    </button>
  </div>
</main>


  <!-- ğŸ—‚ï¸ PANEL CAPAS FTTH -->
  <div id="layersPanel" class="panel panel-capas hidden">

    <div class="panel-header">
      <span class="panel-title">ğŸ—ºï¸ Capas FTTH</span>
      <button id="btnCloseLayers">âœ–</button>
    </div>

    <div id="layersTree" class="panel-content">
      <!-- Ãrbol dinÃ¡mico -->
    </div>

  </div>

  <!-- ğŸš— MODAL NAVEGACIÃ“N -->
  <div id="navModal" class="nav-modal hidden">

    <div class="nav-card">
      <h3>ğŸ§­ Â¿CÃ³mo deseas navegar?</h3>

      <div class="nav-options">
        <button id="btnNavWaze" class="nav-btn waze">
          ğŸš— Waze
        </button>

        <button id="btnNavGoogle" class="nav-btn google">
          ğŸŒ Google Maps
        </button>
      </div>

      <button id="btnNavCancel" class="nav-cancel">
        Cancelar
      </button>
    </div>

  </div>

  <!-- ğŸ›£ï¸ MODAL RUTA -->
  <div id="routeModal" class="route-modal hidden">
    <div class="route-card">

      <div class="route-header">
        <span>ğŸ›£ï¸ Nueva Ruta</span>
        <button id="closeRouteModal">âœ•</button>
      </div>

      <div class="route-body">

        <label>ğŸ“› Nombre</label>
        <input id="routeName" placeholder="Ej: Troncal BA01 Norte">

        <label>ğŸ§± Tipo</label>
        <select id="routeType">
          <option value="troncal">Troncal</option>
          <option value="distribucion">DistribuciÃ³n</option>
          <option value="acometida">Acometida</option>
          <option value="mantenimiento">Mantenimiento</option>
        </select>

        <label>ğŸ¢ Central</label>
        <input id="routeCentral" placeholder="Ej: BACHUE">

        <label>ğŸ“ Observaciones</label>
        <textarea id="routeNotes" placeholder="Notas tÃ©cnicas..."></textarea>

        <p id="routeDistance">Distancia: 0 m</p>

      </div>

      <div class="route-actions">
        <button class="route-btn primary" id="btnSaveRoute">ğŸ’¾ Guardar</button>
        <button class="route-btn danger" id="btnCancelRoute">Cancelar</button>
      </div>

    </div>
  </div>

  <!-- ğŸ”’ MODAL CIERRE -->
  <div id="cierreModal" class="route-modal hidden">
    <div class="route-card">

      <div class="route-header">
        <span>ğŸ”’ Nuevo Cierre</span>
        <button id="closeCierreModal">âœ•</button>
      </div>

      <div class="route-body">

        <label>ğŸ·ï¸ CÃ³digo</label>
        <input id="cierreCodigo" placeholder="Ej: E2BA01_A1">

        <label>ğŸ“¦ Tipo</label>
        <select id="cierreTipo">
          <option value="E1">E1 - DerivaciÃ³n</option>
          <option value="E2">E2 - Splitter</option>
          <option value="NAP">NAP</option>
        </select>

        <label>ğŸ¢ Central</label>
        <select id="cierreCentral">
          <option value="">Seleccione Central</option>
          <option value="BACHUE">BachuÃ©</option>
          <option value="CHICO">ChicÃ³</option>
          <option value="CUNI">Cuni</option>
          <option value="FONTIBON">FontibÃ³n</option>
          <option value="GUAYMARAL">Guaymaral</option>
          <option value="HOLANDA">Holanda</option>
          <option value="MUZU">MuzÃº</option>
          <option value="SANTA_INES">Santa InÃ©s</option>
          <option value="SUBA">Suba</option>
          <option value="TOBERIN">ToberÃ­n</option>
        </select>

        <label>ğŸ§¬ MolÃ©cula</label>
        <select id="cierreMolecula" disabled>
          <option value="">Seleccione MolÃ©cula</option>
        </select>

        <label>ğŸ“ Observaciones</label>
        <textarea id="cierreNotas"></textarea>

      </div>

      <div class="route-actions">
        <button class="route-btn primary" id="btnSaveCierre">ğŸ’¾ Guardar</button>

        <button class="route-btn danger" id="btnDeleteCierre">
          ğŸ—‘ï¸ Eliminar
        </button>

        <button class="route-btn danger" id="btnCancelCierre">
          Cancelar
        </button>
      </div>

    </div>
  </div>

  <!-- ================= MODAL EVENTO ================= -->
  <div id="eventoModal" class="route-modal hidden">

    <div class="modal-content">

      <div class="modal-header">
        <h3>ğŸš¨ Registrar Evento</h3>
        <button id="closeEventoModal">âœ–</button>
      </div>

      <div class="modal-body">

        <label>Tipo</label>
        <select id="eventoTipo">
          <option value="">Seleccione</option>
          <option>VANDALISMO</option>
          <option>CORTE</option>
          <option>OBRAS</option>
          <option>MANTENIMIENTO</option>
        </select>

        <label>AcciÃ³n</label>
        <select id="eventoAccion">
          <option value="">Seleccione</option>
          <option>EMPALME_PROVISIONAL</option>
          <option>AJUSTE DE HILO</option>
          <option>RECONSTRUCCION</option>
          <option>BANDEJA</option>
        </select>

        <label>Estado</label>
        <select id="eventoEstado">
          <option>CRITICO</option>
          <option>PROVISIONAL</option>
          <option>RESUELTO</option>
        </select>
        <label>ğŸ¢ Central</label>
        <select id="eventoCentral">
          <option value="">Seleccione Central</option>
          <option value="BACHUE">BachuÃ©</option>
          <option value="CHICO">ChicÃ³</option>
          <option value="CUNI">Cuni</option>
          <option value="FONTIBON">FontibÃ³n</option>
          <option value="GUAYMARAL">Guaymaral</option>
          <option value="HOLANDA">Holanda</option>
          <option value="MUZU">MuzÃº</option>
          <option value="SANTA_INES">Santa InÃ©s</option>
          <option value="SUBA">Suba</option>
          <option value="TOBERIN">ToberÃ­n</option>
        </select>

        <label>ğŸ§¬ MolÃ©cula</label>
        <select id="eventoMolecula" disabled>
          <option value="">Seleccione MolÃ©cula</option>
        </select>

        <label>Impacto</label>
        <input id="eventoImpacto" placeholder="Ej: Troncal BA01 - 48 fibras">

        <label>TÃ©cnico</label>
        <input id="eventoTecnico" placeholder="Nombre tÃ©cnico">

        <!-- ğŸ“¸ FOTOS DEL EVENTO -->
        <label>ğŸ“· Foto Antes</label>
        <input type="file" id="fotoAntesInput" accept="image/*" capture="environment">
        <div id="fotoAntesPreview" class="foto-preview"></div>

        <label>ğŸ“¸ Foto DespuÃ©s</label>
        <input type="file" id="fotoDespuesInput" accept="image/*" capture="environment">
        <div id="fotoDespuesPreview" class="foto-preview"></div>

        <label>Notas</label>
        <textarea id="eventoNotas"></textarea>

      </div>

      <div class="modal-footer">
        <button id="btnSaveEvento">ğŸ’¾ Guardar</button>
        <button id="btnDeleteEvento">ğŸ—‘ï¸ Eliminar</button>
      </div>

    </div>
  </div>

<!-- LIBS -->
<script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

<!-- CONFIG -->
<!-- âŒ DESHABILITADO: Carga de config.local.js (genera errores 404 y MIME type) -->
<!-- El archivo config.local.js es opcional y se usan valores por defecto de config.js -->
<script>
  // âŒ DESHABILITADO: No cargar config.local.js para evitar errores
  // Inicializar __FTTH_SECRETS__ vacÃ­o para que config.js use valores por defecto
  window.__FTTH_SECRETS__ = window.__FTTH_SECRETS__ || {};
</script>
<script src="../assets/js/config.js"></script>

<!-- âœ… INITIALIZER (debe cargarse antes de otros mÃ³dulos) -->
<script type="module" src="../assets/js/core/initializer.js"></script>

<!-- FIREBASE CORE -->
<script type="module" src="../assets/js/services/firebase.js"></script>
<script type="module" src="../assets/js/services/firebase.db.js"></script>

<!-- FIREBASE SERVICES -->
<script type="module" src="../assets/js/services/firebase.cierres.js"></script>
<script type="module" src="../assets/js/services/firebase.eventos.js"></script>
<script type="module" src="../assets/js/services/firebase.rutas.js"></script>
<script type="module" src="../assets/js/services/firebase.storage.js"></script>

<!-- APP CORE -->
<script src="../assets/js/app.js"></script>
<script src="../assets/js/storage.js"></script>
<script src="../assets/js/storage.cierres.js"></script>
<script src="../assets/js/ui/ui.menu.js"></script>


<!-- MAPA -->
<script src="../assets/js/map/mapa.init.js"></script>
<script src="../assets/js/map/mapa.controls.js"></script>
<script src="../assets/js/map/mapa.layers.js"></script>
<script src="../assets/js/map/mapa.ftth.js"></script>


<!-- TOOLS -->
<script src="../assets/js/tools/tool.medicion.js"></script>
<script src="../assets/js/tools/tool.gps.js"></script>
<script src="../assets/js/tools/tool.navegacion.js?v=2026"></script>
<script src="../assets/js/tools/tool.capas.js"></script>
<script src="../assets/js/tools/tool.rutas.js"></script>
<script src="../assets/js/tools/tool.cierres.js"></script>
<script src="../assets/js/tools/tool.eventos.js"></script>

<!-- UI -->
<script src="../assets/js/ui/ui.panel.js"></script>
<script src="../assets/js/ui/ui.layers.tree.js"></script>



</body>

</html>