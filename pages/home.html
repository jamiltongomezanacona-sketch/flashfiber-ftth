<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Flash Fiber FTTH | Panel Principal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Base del proyecto -->
  <link rel="stylesheet" href="../assets/css/theme.css">
  <link rel="stylesheet" href="../assets/css/layout.css">

  <!-- Fuente -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>

<body class="app-dashboard">

  <!-- ================= HEADER ================= -->
  <header>
    <div class="brand">
      <div class="title">Flash Fiber FTTH</div>
      <div class="subtitle">Panel Operativo</div>
    </div>

    <div class="user-box">
      <div class="user-name" id="usernameDisplay">Cargando...</div>
      <button class="btn-logout" id="logoutBtn">Cerrar sesiÃ³n</button>
    </div>
  </header>

  <!-- ================= MAIN ================= -->
  <main>

    <section class="welcome">
      <h1>Bienvenido ğŸ‘‹</h1>
      <p>Seleccione un mÃ³dulo para comenzar la operaciÃ³n.</p>
    </section>

    <section class="grid">

      <div class="card" data-link="mapa-ftth.html">
        <div class="badge">Activo</div>
        <div class="card-icon">ğŸ—ºï¸</div>
        <div class="card-title">Visor GIS</div>
        <div class="card-desc">
          VisualizaciÃ³n completa de red FTTH, troncales, cierres, NAP y eventos.
        </div>
      </div>

      <div class="card">
        <div class="badge">PrÃ³ximamente</div>
        <div class="card-icon">ğŸ“Š</div>
        <div class="card-title">Dashboard Operativo</div>
        <div class="card-desc">
          KPIs, fallas y control de SLA.
        </div>
      </div>

      <div class="card">
        <div class="badge">PrÃ³ximamente</div>
        <div class="card-icon">ğŸ“¡</div>
        <div class="card-title">Inventario</div>
        <div class="card-desc">
          GestiÃ³n de cables, cierres y capacidad.
        </div>
      </div>

      <div class="card">
        <div class="badge">Admin</div>
        <div class="card-icon">âš™ï¸</div>
        <div class="card-title">ConfiguraciÃ³n</div>
        <div class="card-desc">
          Usuarios, permisos y parÃ¡metros globales.
        </div>
      </div>

    </section>

    <footer>
      Â© 2026 Flash Fiber Â· Plataforma FTTH
    </footer>

  </main>

  <!-- ================= FIREBASE ================= -->
  <script type="module" src="../assets/js/services/firebase.js"></script>

  <!-- ================= LÃ“GICA HOME ================= -->
  <script type="module">
    import { auth } from "../assets/js/services/firebase.js";
    import {
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    /* ======================================================
       ProtecciÃ³n REAL con Firebase
    ====================================================== */

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        // âŒ Sin sesiÃ³n â†’ login
        window.location.replace("../index.html");
        return;
      }

      // âœ… Usuario autenticado
      console.log("âœ… SesiÃ³n activa:", user.uid);

      // Obtener perfil cargado por firebase.js
      const profile = window.__USER__;

      if (!profile || profile.activo !== true) {
        console.warn("âŒ Usuario sin perfil o inactivo");
        window.location.replace("../index.html");
        return;
      }

      // Mostrar nombre
      document.getElementById("usernameDisplay").textContent =
        profile.nombre || "Usuario";

      // NavegaciÃ³n
      document.querySelectorAll(".card[data-link]").forEach(card => {
        card.addEventListener("click", () => {
          window.location.href = card.dataset.link;
        });
      });

      // Logout real
      document.getElementById("logoutBtn").addEventListener("click", async () => {
        await signOut(auth);
        window.location.replace("../index.html");
      });
    });
  </script>

</body>
</html>
