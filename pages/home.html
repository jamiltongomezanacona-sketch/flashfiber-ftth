<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Flash Fiber FTTH | Panel Principal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- CSS base -->
  <link rel="stylesheet" href="../assets/css/theme.css">
  <link rel="stylesheet" href="../assets/css/layout.css">

  <!-- Fuente -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>

<body class="app-dashboard">

  <!-- ================= HEADER ================= -->

  <header class="header">
    <div class="brand">
      <div class="title">Flash Fiber FTTH</div>
      <div class="subtitle">Panel Operativo</div>
    </div>

    <div class="user-box">
      <div class="user-name" id="usernameDisplay">Cargando...</div>
      <button class="btn-logout" id="logoutBtn">Cerrar sesiÃ³n</button>
    </div>
  </header>

  <!-- ================= MAIN ================= -->

  <main class="container">

    <section class="welcome">
      <h1>Bienvenido ğŸ‘‹</h1>
      <p>Seleccione un mÃ³dulo para comenzar la operaciÃ³n.</p>
    </section>

    <section class="grid">

      <div class="card" data-link="mapa-ftth.html">
        <div class="badge">Activo</div>
        <div class="card-icon">ğŸ—ºï¸</div>
        <div class="card-title">Visor GIS</div>
        <div class="card-desc">
          VisualizaciÃ³n completa de red FTTH, troncales, cierres, NAP y eventos.
        </div>
      </div>

      <div class="card">
        <div class="badge">PrÃ³ximamente</div>
        <div class="card-icon">ğŸ“Š</div>
        <div class="card-title">Dashboard</div>
        <div class="card-desc">
          KPIs, fallas, SLA y analÃ­tica operacional.
        </div>
      </div>

      <div class="card">
        <div class="badge">PrÃ³ximamente</div>
        <div class="card-icon">ğŸ“¡</div>
        <div class="card-title">Inventario</div>
        <div class="card-desc">
          GestiÃ³n de cables, cierres, splitters y reservas.
        </div>
      </div>

      <div class="card">
        <div class="badge">Admin</div>
        <div class="card-icon">âš™ï¸</div>
        <div class="card-title">ConfiguraciÃ³n</div>
        <div class="card-desc">
          Usuarios, permisos y parÃ¡metros globales.
        </div>
      </div>

    </section>

    <footer class="footer">
      Â© 2026 Flash Fiber Â· Plataforma FTTH
    </footer>

  </main>

  <!-- ================= SCRIPT ================= -->
  <!-- IMPORTANTE: type="module" -->

  <script type="module">
    import { auth } from "../assets/js/services/firebase.js";
    import {
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    /* ======================================================
       HOME | ProtecciÃ³n REAL con Firebase Auth + Firestore
    ====================================================== */

    onAuthStateChanged(auth, (user) => {

      // âŒ No hay sesiÃ³n
      if (!user) {
        window.location.replace("../index.html");
        return;
      }

      console.log("âœ… SesiÃ³n Firebase activa:", user.uid);

      // â³ Esperar perfil cargado desde firebase.db.js
      const waitProfile = setInterval(() => {
        const profile = window.__USER__;

        if (!profile) return;

        clearInterval(waitProfile);

        // âŒ Usuario inactivo
        if (profile.activo !== true) {
          console.warn("âŒ Usuario inactivo");
          window.location.replace("../index.html");
          return;
        }

        // âœ… Usuario vÃ¡lido
        console.log("ğŸ‘¤ Perfil cargado:", profile);

        // Mostrar nombre
        document.getElementById("usernameDisplay").textContent =
          profile.nombre || "Usuario";

        // NavegaciÃ³n de tarjetas
        document.querySelectorAll(".card[data-link]").forEach(card => {
          card.addEventListener("click", () => {
            window.location.href = card.dataset.link;
          });
        });

        // Logout real
        document.getElementById("logoutBtn").addEventListener("click", async () => {
          await signOut(auth);
          window.location.replace("../index.html");
        });

      }, 100);
    });
  </script>

</body>

</html>
